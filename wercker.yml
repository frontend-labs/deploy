box: node
build:
  steps:
    - script:
        name: "yarn install"
        code: |
          yarn
          yarn build
deploy:
  steps:
    - install-packages:
        packages: openssh-client rsync

    - add-to-known_hosts:
        hostname: $HOSTNAME

    - mktemp:
        envvar: PRIVATE_KEYPATH

    - create-file:
        name: write key
        filename: $PRIVATE_KEYPATH 
        content: $WERCKER_PRIVATE
        overwrite: true

    - script:
        name: transfer blog
        code: |
            rsync -au -e "ssh -i $PRIVATE_KEYPATH -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" --progress public/* $USER@$HOSTNAME:/var/www/deploy.frontendlabs
            ssh -i $PRIVATE_KEYPATH -l root -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $HOSTNAME chown -R www-data:www-data /var/www/